# 更新日志 (Changelog)

本文档记录项目所有重要的变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [Unreleased]

### 计划中
- 插件系统架构 - 构建开放的扩展生态
- 自定义快捷键支持 - 个性化操作体验
- 代码片段管理器 - 高效的代码复用
- Markdown 实时预览 - 所见即所得编辑
- 多光标编辑增强 - 更强大的批量编辑能力

---

## [0.2.7] - 2026-01-09

### 🚀 重大变更
- **AI 代码回滚**: 引入一键撤销 AI 变更功能，支持新增、修改及删除操作的回滚。
- **智能 Diff**: 优化行级对比算法，大幅提升代码变更审阅的精确度与可视性。
- **工业级 UI**: 升级 `LayoutSwitcher`，支持更灵活的自定义布局切换，满足多样化开发场景。
- **自动化测试**: 引入全链路 E2E 自动化测试框架，完成核心功能验证并集成 mock 数据生成器。

### ✨ 优化
- **性能优化**: 深度优化流式渲染管线，通过合并相邻文本片段减少 40% 的 DOM 节点，响应更迅速。
- **编辑器体验**: 修复语义导航与语法高亮失效问题，优化多标签切换的流畅度。
- **Agent 通讯**: 彻底修复 Bash 工具结果向 LLM 传递的丢失问题，确保智能体决策链路完整。

### 🐛 问题修复
- **持久化修复**: 解决编辑器状态在某些场景下无法正确持久化的问题。
- **模块兼容**: 修复 ES 模块导入错误，提升不同环境下插件的加载稳定性。
- **环境隔离**: 修复线程隔离导致的会话干扰 Bug。

---

## [0.2.6] - 2026-01-07

### 🚀 重大变更
- **Agent 进化**: 解锁 Shell 系统级访问能力，Agent 可执行 `npm`, `git` 等命令自主配置环境。
- **OpenSpec 融合**: 深度集成 OpenSpec 协议标准，开启“规范驱动 (Spec-Driven)”的 AI 开发新范式。
- **Token 可视化**: 对话界面新增实时 Token 计数与消耗分析，助力精准掌控 API 使用成本。
- **Markdown 增强**: 引入全新的实时预览引擎，支持分屏/预览多模式切换，显著提升文档生产力。
- **自定义 API**: 全面支持 OpenAI 兼容接口，无缝接入 DeepSeek、Moonshot 等第三方模型服务。
- **任务拆解**: 引入 Task Breakdown Service，支持将模糊需求转化为可视化的结构化任务树。
- **路径感知**: 实现 Agent 运行时的根目录自动校准与自我纠错，彻底解决开发/生产环境路径不一致问题。

### ✨ 优化
- **性能调优**: 优化流式渲染管线与内存管理，通过 **10,000 级**压力测试，CPU 占用降低 30%。
- **自动化测试**: 建立全链路 E2E 测试体系，新增 50+ 核心用例，覆盖 Agent 执行、文件操作及状态持久化。
- **虚拟滚动**: Snippet Manager 全面接入虚拟列表技术，支持万级代码片段的流畅预览与管理。
- **智能反馈**: 增强 Bash 工具的 stderr 分析能力，当命令失败时主动提供路径提示，打破重试死循环。
- **本地体验**: 优化本地模型（Local LLM）的长文本自动续写与 Token 计数管理。
- **状态同步**: 任务执行状态实时同步至文件系统，支持断点续传。

### 🐛 问题修复
- **RAG 隔离**: 修复项目切换时的索引残留问题，确保代码检索上下文纯净。
- **路径一致性**: 统一 Bash 与文件系统工具的路径解析逻辑，消除 Agent 的“精神分裂”现象。
- **死循环**: 修复因空反馈导致的 Agent 重复执行工具调用 Bug。

---

## [0.2.5] - 2026-01-03

### 🚀 重大变更
- **混合智能架构**: 引入端侧模型支持，实现 Local-First 的 AI 体验。集成 Qwen2.5-Coder 等高性能轻量模型。
- **智能路由器**: 新增 `IntelligenceRouter` 模块，动态分发任务至本地或云端，平衡隐私、速度与能力。
- **离线工作流**: 支持完全离线环境下的代码补全与基础对话功能。

### ✨ 优化
- **FIM 补全**: 基于本地模型实现了 Fill-In-the-Middle 能力，提升补全准确率。
- **用户引导**: 新增首次启动的模型下载引导与环境配置向导。
- **资源调度**: 优化了本地模型加载时的内存占用与释放策略。

---

## [0.2.4] - 2025-12-30

### 🚀 重点修复
- **Windows 闪屏修复**: 彻底解决了在 Windows 平台下，流式代码生成过程中编辑器频繁闪烁和内容跳动的问题。
- **渲染性能**: 优化了流式文本的渲染逻辑，移除了不必要的节流机制，使打字机效果更加自然流畅。
- **版本规范**: 统一了全项目的版本号管理，确保 `package.json`、`Cargo.toml` 和 `tauri.conf.json` 严格一致。

### ✨ 优化
- **UI 稳定性**: 增强了 Markdown 渲染组件的稳定性，防止在解析复杂代码块时出现布局抖动。
- **构建流程**: 完善了 Windows 平台的自动化构建流程，确保发布包的完整性。

---

## [0.2.3] - 2025-12-27

### 🚀 重大变更
- **任务监控**: 推出工业级任务监控系统（Task Monitor），支持实时日志流、可视化进度追踪及关键性能指标统计。
- **项目配置**: 引入 `IFAI.md` 配置文件机制，支持项目级的自定义指令（Custom Instructions）与 AI 行为规范。
- **交互升级**: 文件树全面支持虚拟滚动与完整右键菜单（新建/删除/重命名），大文件列表渲染性能提升 10 倍。

### ✨ 优化
- **探索引擎**: 重构 Explore Agent，通过 `ExploreStore` 统一扫描状态管理，解决进度显示不同步问题。
- **搜索体验**: 增强搜索面板功能，新增历史记录、实时预览及键盘快速导航。
- **性能架构**: 实现 Rust 后端并行目录扫描与增量 Git 状态更新，显著降低文件系统操作延迟。
- **监控工具**: 新增缓存命中率（Cache Stats）与性能监控面板，实时掌握系统运行状态。

### 🐛 问题修复
- **配置初始化**: 修复新打开项目时 `IFAI.md` 未能自动生成默认模板的问题。
- **状态同步**: 解决后台扫描任务与前端 UI 状态偶尔脱节的 Bug。
- **UI 细节**: 统一了全应用范围内的进度条与状态徽章（Badge）样式。

---

## [0.2.2] - 2025-12-26

### 🚀 重大变更
- **多会话支持**: 引入完整的多会话（Multi-Thread）管理系统，支持标签页切换、会话创建/删除及并行任务处理。
- **数据持久化**: 实现基于 IndexedDB 的全量数据本地持久化，支持历史会话的自动保存与恢复。
- **性能飞跃**: 后端文件扫描引擎迁移至 `walkdir` crate，目录遍历速度提升数倍。

### ✨ 优化
- **UI 交互**: 新增 `ThreadTabs` 和 `ThreadSearchBar` 组件，提供类似浏览器的多任务管理体验。
- **可视化**: 重构 Explore Agent 的执行反馈，新增 `ExploreProgress` 和 `ExploreFindings` 组件，实时展示扫描进度与结果。
- **数据管理**: 设置面板新增数据管理模块，支持用户手动清理或导出对话数据。

### 🐛 问题修复
- **会话隔离**: 修复切换会话时消息列表残留的问题，确保上下文严格隔离。
- **状态同步**: 修复任务监视器在流式扫描时的状态更新延迟问题。

---

## [0.2.1] - 2025-12-26

### 🚀 重大变更
- **架构分离**: 完成社区版与商业版的架构分离，通过 Feature Flags 和核心 Trait 抽象层解耦，支持通过 `APP_EDITION` 环境变量动态切换。
- **自动批准**: 新增工具调用自动批准逻辑 (`agentAutoApprove`)，大幅提升 Agent 连续执行任务的流畅度。
- **模型升级**: 更新智谱 AI 模型列表至 `glm-4.7` 并设为默认，提升中文语境下的推理能力。

### ✨ 优化
- **智能上下文**: 优化消息上下文构建逻辑，智能筛选发送给 LLM 的历史消息，避免 Token 浪费并提升响应速度。
- **流式体验**: 优化流式输出时的代码高亮与打字机效果，解决流式渲染过程中的样式遮挡问题。
- **RAG 体验**: 实现 RAG 索引自动初始化，无需用户手动触发即可享受代码库问答能力。
- **文件扫描**: `agent_list_dir` 工具增加常用大文件排除列表，提升目录扫描性能。

### 🐛 问题修复
- **消息序列化**: 彻底修复聊天消息发送时的 `missing field 'name'` 错误及 ToolCall 序列化问题，确保 API 调用稳定性。
- **类型兼容**: 深度完善核心层类型定义（Message, ToolCall），解决前后端在 snake_case 与 camelCase 之间的序列化兼容性问题。
- **工具执行**: 修复工具调用参数的流式解析逻辑，支持代码内容的实时渲染。
- **构建系统**: 修复 Rust 编译错误及 CI 构建流程，确保商业版与社区版构建产物的正确性。
- **其他修复**: 修复对话摘要误触发、Sidebar 图标缺失、环境变量注入等细节问题。

---

## [0.2.0] - 2025-12-20 - 交互体感与性能跨越式升级

### 🚀 重磅更新

**若爱 (IfAI) v0.2.0** 迎来了交互体感与渲染性能的双重里程碑式升级！我们不仅实现了"渐进式、低延迟"的智能体交互，更通过 GPU 硬件加速管线与深度 UX 优化，打造了丝滑、直觉且持久的编程体验。

### ✨ 核心亮点

#### ⚡ 极致渲染性能 (GPU 加速)
- **120 FPS 高帧率支持** - 针对高刷显示器深度优化渲染调度，确保滚动、光标闪烁及动画达到视觉上限。
- **硬件加速集成** - 全面启用 Canvas/WebGL 硬件加速，大幅降低高负载场景下的 CPU 渲染压力。
- **AI 生成零延迟 (Zero-Lag)** - 引入 150ms 节流更新与动态性能降级，彻底解决 AI 大规模生成代码时的编辑器卡顿。
- **性能监控面板** - 新增 `Mod+Alt+p` 快捷键，实时掌控 FPS 与系统运行状态。

#### 🌊 Claude-style 流式交互系统
- **打字机效果 (Typewriter Effect)** - AI 工具调用呈现流畅的逐行生成效果，实时观察代码诞生过程。
- **渐进式参数提取** - 核心 Rust 后端支持实时提取流式响应中的不完整参数，实现亚秒级视觉反馈。
- **流式光标反馈** - 工具预览区域增加动态脉冲光标，显著提升实时交互的确定性与心理反馈。

#### ⌨️ 深度 UX 与键盘导航优化
- **持久化对话历史** - 引入专门的 `chatUIStore`，支持使用键盘向上/向下键唤回历史输入，即便重启应用记录依然存在。
- **全局键盘导航支持** - 彻底重构了斜杠命令 (Slash Commands) 与项目搜索 (Cmd+P) 的键盘逻辑，支持流畅的上下键切换与回车确认。
- **智能索引管理** - 精确识别用户手动输入与系统自动填充，确保历史记录切换逻辑完全符合开发者直觉。

#### 🛡️ 智能体监控器 (Agent Monitor) 2.0
- **自由拖拽与磁力吸附** - 监控器可随处拖动并智能吸附到屏幕角落，永远保持界面整洁且不挡代码。
- **智能布局自适应** - 面板会根据吸附位置自动调整展开逻辑，确保交互符合逻辑直觉。
- **全方位中文化支持** - 任务状态、实时日志及所有提示信息均已完美接入国际化系统。

#### 📐 渲染引擎优化
- **逻辑顺序重构** - 深度优化渲染管线，确保 Agent 执行总结始终位于消息最底部，使长文本对话更有条理。
- **UI 细节极简化** - 采用极简 Logo 标识并移除冗余标题，为代码沟通腾出更多核心视觉空间。

### 🛠 技术改进

- **Zustand Selector 优化** - 全面应用精准状态订阅，彻底消除 AI 生成时导致的全局组件无效重绘。
- **渲染隔离 (Containment)** - 为聊天面板应用 `contain: layout` CSS 属性，有效隔离局部布局压力。
- **正则启发式解析** - 引入健壮的部分字符串提取算法，大幅提升流式数据的实时解析成功率。
- **稳定回调引用** - 全面使用 `useCallback` 稳定核心处理函数，使 `React.memo` 在高频更新场景下真正生效。

---

## [0.1.2] - 2025-12-19 - 智能化体验升级

### 🚀 重磅更新

**若爱 (IfAI) v0.1.2** 带来了革命性的智能化体验升级！这个版本不仅仅是功能的堆砌，更是我们对"AI 原生编辑器"理念的深度实践。通过引入窗口智能管理、文件交互革新、AI 工具链闭环等核心特性，我们正在重新定义编程工具的未来。

### ✨ 核心亮点

#### 🎯 AI 工具调用闭环系统
- **智能审批机制** - AI 的每个文件操作都需要用户确认，确保安全可控
- **Diff 预览功能** - 可视化展示 AI 提议的代码变更，拒绝黑盒操作
- **操作历史追踪** - 完整记录 AI 的所有工具调用，可追溯可回滚
- **多轮对话优化** - 支持复杂的代码重构和批量修改场景

> 💡 **技术突破**：我们构建了业界首个将 AI 操作完全透明化的编辑器，让 AI 真正成为可信赖的编程伙伴，而非神秘的黑盒。

#### 🪟 窗口智能管理系统
- **状态持久化** - 记住您的所有布局偏好，重启后完美还原
- **多窗口同步** - 主副窗口实时联动，文件状态跨窗口同步
- **智能关闭逻辑** - 优雅的多窗口生命周期管理
- **Vite 热更新修复** - 解决开发模式下的热重载问题

> 🎨 **用户体验**：无论是单屏专注模式还是多屏协作场景，IfAI 都能提供最贴合您工作习惯的界面布局。

#### 📁 文件交互革新
- **拖拽操作支持** - 文件树内自由拖拽，外部文件直接拖入编辑器
- **智能文件识别** - 自动识别拖入文件的类型和编码
- **跨平台兼容** - Windows、macOS、Linux 全平台拖拽支持
- **批量操作优化** - 支持多文件同时拖拽处理

> ⚡ **效率提升**：告别繁琐的文件打开对话框，拖拽即所得，让灵感流畅转化为代码。

#### ⌨️ 快捷键生态完善
- **配置导入导出** - 一键迁移您的 VSCode/Sublime 快捷键方案
- **预设方案切换** - 内置多种主流编辑器方案，零学习成本
- **国际化支持** - 所有快捷键提示支持中英文双语显示
- **冲突检测机制** - 智能识别并提示快捷键冲突

> 🎯 **无缝迁移**：从其他编辑器迁移到 IfAI，您的肌肉记忆完全保留，甚至更加强大。

### 🛠 技术架构升级

#### 前端性能优化
- **状态管理重构** - Zustand 状态持久化，减少 40% 的内存占用
- **组件懒加载** - 按需加载非核心组件，启动速度提升 25%
- **虚拟滚动优化** - 大文件列表渲染性能提升 60%
- **内存泄漏修复** - 解决多窗口场景下的内存泄漏问题

#### 后端架构强化
- **Rust 异步优化** - tokio 运行时调优，并发处理能力提升 50%
- **事件总线升级** - 前后端通信延迟降低至 5ms 以内
- **错误处理完善** - 全链路错误捕获与恢复机制
- **安全沙箱强化** - AI 工具调用权限系统升级

#### AI 核心能力增强
- **RAG 检索优化** - 向量索引构建速度提升 3 倍
- **上下文压缩** - 智能上下文管理，支持更大代码库
- **多模型负载均衡** - 动态选择最优 AI 模型
- **缓存策略升级** - 查询响应速度提升 70%

### 📊 性能指标

| 指标 | v0.1.0 | v0.1.2 | 提升 |
|------|--------|--------|------|
| 启动时间 | < 2s | < 1.5s | ⚡ 25% |
| 内存占用 | ~100MB | ~80MB | 🚀 20% |
| 文件搜索速度 | 100ms | 30ms | ⚡ 70% |
| AI 响应延迟 | 2-5s | 0.5-2s | 🎯 60% |
| 大文件加载 | 1s+ | 0.3s | 🚀 70% |

### 🐛 问题修复

#### 关键问题
- **修复** 多窗口状态下文件保存冲突问题
- **修复** AI 工具调用时的 JSON 解析异常
- **修复** 布局持久化在某些边缘情况下的语法错误
- **修复** 文件拖拽时的编码识别错误
- **修复** 快捷键冲突导致的编辑器行为异常

#### 体验优化
- **优化** 文件树右键菜单的响应速度
- **优化** AI 对话界面的滚动行为
- **优化** 终端模拟器的 ANSI 序列解析
- **优化** 设置面板的多语言切换体验

### 🔮 技术前瞻

v0.1.2 版本为后续的智能化升级奠定了坚实基础：

- **AI Agent 框架** - 为 AI 自主编程任务提供完整支持
- **多模态交互** - 支持语音、图像等多种输入方式
- **插件化架构** - 即将开放的插件系统将支持社区创新
- **云同步服务** - 为团队协作功能提供技术储备

### 💬 用户反馈

> "IfAI 的 AI 工具调用闭环让我第一次感到 AI 是可信的编程助手，而不是在碰运气。" - 资深全栈开发者

> "多窗口同步功能完美解决了我在多屏开发时的痛点，这才是现代化的编程工具！" - 开源项目维护者

> "从 VSCode 迁移过来毫无压力，快捷键配置一键导入，太贴心了。" - 前端工程师

---

## [0.1.0] - 2025-12-17 - 创世发布

### 🎉 首次发布

**若爱 (IfAI) 编辑器** 首个公开版本发布！这是一款基于 Tauri 2.0 + React 19 构建的跨平台 AI 代码编辑器。

### ✨ 新增功能

#### 核心编辑器
- **Monaco Editor 集成** - VSCode 同款编辑器引擎
  - 完整的代码高亮和语法支持
  - 智能代码补全
  - 代码折叠和缩进
  - 多种主题支持
- **多标签页编辑** - 高效管理多个文件
  - 标签页拖拽排序
  - 快速切换和关闭
  - 未保存文件标记
- **文件系统管理**
  - 文件树浏览器
  - 文件夹打开和刷新
  - 文件创建、重命名、删除 (规划中)
  - Git 状态集成显示

#### AI 智能助手
- **多模型支持** - 支持主流 AI 模型
  - OpenAI GPT 系列 (GPT-4, GPT-3.5)
  - Anthropic Claude 系列 (Claude 3.5 Sonnet, Claude 3 Opus)
  - 智谱 AI (GLM-4, GLM-3-Turbo)
  - 自定义 API 端点支持
- **AI 对话界面**
  - 流式响应输出
  - Markdown 渲染
  - 代码块语法高亮
  - 对话历史管理
- **上下文增强** (核心能力)
  - RAG 检索增强生成
  - 项目代码索引
  - 语义化搜索
  - 智能上下文构建
- **Agent 工具支持** (核心能力)
  - 文件读写工具
  - 目录列表工具
  - 工具调用审批机制
  - 部分 JSON 解析支持

#### 开发工具
- **集成终端** - 功能完整的终端模拟器
  - PTY (伪终端) 支持
  - 多终端会话管理
  - 终端大小自适应
  - ANSI 转义序列支持
- **Git 集成**
  - 文件状态追踪 (新增、修改、删除)
  - 可视化状态显示
  - Git 仓库检测
- **LSP 客户端** - 语言服务器协议支持
  - 代码智能提示
  - 定义跳转
  - 错误诊断
  - 代码格式化
- **全局搜索**
  - 文件名搜索 (模糊匹配)
  - 文件内容搜索 (正则表达式)
  - 搜索结果预览

#### 用户体验
- **多语言界面** - 中英文切换
  - i18next 国际化框架
  - 浏览器语言自动检测
  - 设置中手动切换
- **主题系统**
  - 深色主题 (默认)
  - 浅色主题 (规划中)
  - TailwindCSS 样式系统
- **响应式布局**
  - 可调整分栏尺寸
  - 侧边栏折叠
  - 自适应不同屏幕尺寸

### 🏗 技术架构

#### 前端技术栈
- **React 19** - 最新 UI 框架
- **TypeScript 5.8** - 类型安全
- **Zustand** - 轻量状态管理
- **TailwindCSS 3.4** - 实用优先 CSS 框架
- **Vite 7** - 快速构建工具
- **Monaco Editor** - 代码编辑器核心

#### 后端技术栈
- **Tauri 2.0** - 跨平台应用框架
- **Rust** - 系统级编程语言
- **tokio** - 异步运行时
- **reqwest** - HTTP 客户端 (AI API 调用)
- **git2** - Git 库集成
- **portable-pty** - 跨平台终端
- **serde** - 序列化框架

#### 核心架构特性
- **双协议架构** - 开源框架 + 私有核心
  - 开源部分: MIT 协议
  - 核心 AI: 商业协议
- **依赖注入** - 核心包与主应用解耦
- **事件驱动** - 前后端异步通信
- **插件化设计** - 易于扩展的架构

### 🧪 测试覆盖

- **Spec 测试套件** - 4 个核心测试用例
  - `spec_agent_flow.cjs` - Agent 工作流测试
  - `spec_escape_fix.cjs` - 转义序列处理测试
  - `spec_openfile_update.cjs` - 文件刷新逻辑测试
  - `spec_tool_history.cjs` - 工具历史构建测试

### 📦 构建产物

- **跨平台支持**
  - Windows (x64, ARM64)
  - macOS (Intel, Apple Silicon)
  - Linux (x64, ARM64)
- **包体积优化**
  - 前端构建: ~1.4 MB (gzip 压缩)
  - 应用包大小: 5-10 MB (取决于平台)
- **性能指标**
  - 启动时间: < 2 秒
  - 内存占用: ~100 MB (基础)
  - 编辑器响应: < 16ms (60 FPS)

### 🐛 已知问题

- 文件树不支持拖拽操作
- 未实现文件创建/删除功能
- Git 功能仅支持状态显示,不支持提交操作
- LSP 客户端功能仍在完善中
- 部分语言的语法高亮不完整

### 📸 截图

应用界面展示:

**主界面 - 代码编辑与文件管理**
![主界面](./imgs/ifai2025001.png)

**AI 智能助手 - 代码生成与对话**
![AI助手](./imgs/ifai2025002.png)

**集成终端 - 无缝命令执行**
![集成终端](./imgs/ifai2025003.png)

### 📝 文档

- 完整的中文 README.md
- 英文 README (README_EN.md)
- MIT 开源协议声明
- 贡献指南 (CONTRIBUTING.md)
- 技术架构文档
- 快速开始指南

### 🙏 致谢

感谢以下开源项目的支持:
- Tauri - 跨平台框架
- Monaco Editor - 代码编辑器
- React - UI 框架
- Rust 社区 - 强大的生态系统

---

## 版本说明

### 版本号规则
- **主版本号 (Major)**: 重大架构变更或不兼容的 API 修改
- **次版本号 (Minor)**: 新增功能,保持向后兼容
- **修订号 (Patch)**: Bug 修复和小改进

### 变更类型标记
- `新增` / `Added` - 新功能
- `变更` / `Changed` - 现有功能的变更
- `弃用` / `Deprecated` - 即将移除的功能
- `移除` / `Removed` - 已移除的功能
- `修复` / `Fixed` - Bug 修复
- `安全` / `Security` - 安全性改进

---

## 链接

- [项目主页](https://github.com/peterfei/ifai)
- [问题反馈](https://github.com/peterfei/ifai/issues)
- [版本发布](https://github.com/peterfei/ifai/releases)

---

**注**: 版本 0.1.0 之前的开发历史未记录在本变更日志中。