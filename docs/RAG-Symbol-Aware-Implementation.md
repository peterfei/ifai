# RAG ç¬¦å·æ„ŸçŸ¥åŠŸèƒ½å®ç°æ€»ç»“

> **ç‰ˆæœ¬**: v0.2.8
> **æ—¥æœŸ**: 2026-01-11
> **åŠŸèƒ½**: AI ä»£ç ç†è§£èƒ½åŠ›æå‡

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

RAG (Retrieval-Augmented Generation) ç¬¦å·æ„ŸçŸ¥åŠŸèƒ½è®© AI èƒ½å¤ŸçœŸæ­£"ç†è§£"ä»£ç ç»“æ„ï¼Œè€Œéç®€å•çš„æ–‡æœ¬åŒ¹é…ã€‚é€šè¿‡åˆ†æä»£ç çš„è¯­æ³•ç»“æ„å’Œç¬¦å·å…³ç³»ï¼ŒAI å¯ä»¥ï¼š

- **è¯†åˆ« Trait/æ¥å£å®ç°ç±»** - çŸ¥é“å“ªäº›ç±»å®ç°äº†ç‰¹å®šçš„ Trait
- **åˆ†æä¾èµ–å…³ç³»** - ç†è§£æ¨¡å—ä¹‹é—´çš„ä¾èµ–å’Œå½±å“èŒƒå›´
- **åŒºåˆ†çœŸå®ä»£ç å’Œæ³¨é‡Š** - ä¸ä¼šæŠŠæ³¨é‡Šä¸­çš„ç¤ºä¾‹ä»£ç å½“ä½œçœŸå®å®ç°

---

## ğŸ¯ æ ¸å¿ƒä»·å€¼

### 1. è´¨çš„é£è·ƒ

| ç»´åº¦ | ä¼ ç»Ÿ AI åŠ©æ‰‹ | RAG ç¬¦å·æ„ŸçŸ¥ |
|------|-------------|-------------|
| ä»£ç ç†è§£ | æ–‡æœ¬åŒ¹é… | ç¬¦å·å…³ç³»åˆ†æ |
| å‡†ç¡®æ€§ | å®¹æ˜“è¢«æ³¨é‡Šè¯¯å¯¼ | åŒºåˆ†çœŸå®å®ç° |
| ä¸Šä¸‹æ–‡ | å•æ–‡ä»¶ç†è§£ | è·¨æ–‡ä»¶ä¾èµ–åˆ†æ |
| å®ç”¨æ€§ | é€šç”¨å»ºè®® | ç²¾å‡†ä»£ç ä¿®æ”¹å»ºè®® |

### 2. åº”ç”¨åœºæ™¯

```rust
// ç”¨æˆ·æé—®ï¼š"è¿™ä¸ª Trait æœ‰å“ªäº›å…·ä½“å®ç°ï¼Ÿ"

// ä¼ ç»Ÿ AI å›ç­”ï¼š
"æ ¹æ®ä»£ç ä¸­çš„æ³¨é‡Šï¼Œå¯èƒ½æœ‰ä»¥ä¸‹ç±»ä¼¼çš„å®ç°ï¼š
- ErrorHandlerï¼ˆæœªå®ç° Handlerï¼‰
- LoggingHandlerï¼ˆæœªå®ç° Handlerï¼‰
..."

// RAG ç¬¦å·æ„ŸçŸ¥ AI å›ç­”ï¼š
"Repository trait æœ‰ä»¥ä¸‹å®ç°ç±»ï¼š
- /test_project/src/user_repository.rs: UserRepository
- /test_project/src/post_repository.rs: PostRepository
- /test_project/src/comment_repository.rs: CommentRepository"
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·æé—®                              â”‚
â”‚           "ä¿®æ”¹ RagService ä¼šå½±å“å“ªäº›æ¨¡å—ï¼Ÿ"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RAG æ£€ç´¢ç³»ç»Ÿ                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. ä»£ç ç¬¦å·ç´¢å¼• (ASTåˆ†æ)                         â”‚  â”‚
â”‚  â”‚    - Trait å®šä¹‰                                    â”‚  â”‚
â”‚  â”‚    - å®ç°ç±» (impl Trait for Class)                â”‚  â”‚
â”‚  â”‚    - ä¾èµ–å…³ç³» (use/import statements)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. è¯­ä¹‰æœç´¢ (å‘é‡æ£€ç´¢)                           â”‚  â”‚
â”‚  â”‚    - æŸ¥æ‰¾ç›¸å…³ä»£ç ç‰‡æ®µ                              â”‚  â”‚
â”‚  â”‚    - æå–å‡½æ•°/ç±»å®šä¹‰                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               AI å¢å¼ºç”Ÿæˆ (LLM)                          â”‚
â”‚  é—®é¢˜ + æ£€ç´¢åˆ°çš„ä»£ç ä¸Šä¸‹æ–‡ â†’ ç²¾å‡†å›ç­”                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### E2E æµ‹è¯•è¦†ç›–

```typescript
// tests/e2e/rag-symbol-aware.spec.ts

test('RAG-003: AI ç†è§£ Trait å®ç°å…³ç³»', async () => {
  // å‡†å¤‡æµ‹è¯•ä»£ç åº“
  mockFS.set('/test_project/src/repository.rs', 'pub trait Repository { ... }');
  mockFS.set('/test_project/src/user_repository.rs', 'impl Repository for UserRepository { ... }');
  // ...

  // éªŒè¯ AI èƒ½è¯†åˆ«æ‰€æœ‰å®ç°ç±»
  expect(aiResponse).toContain('user_repository.rs');
  expect(aiResponse).toContain('post_repository.rs');
});

test('RAG-004: AI åˆ†æä¾èµ–å…³ç³»', async () => {
  // åˆ›å»º RagService åŠå…¶ä¾èµ–æ¨¡å—
  mockFS.set('/test_project/src/services/rag_service.rs', 'pub trait RagService { ... }');
  mockFS.set('/test_project/src/services/chat_service.rs', 'pub struct ChatService { rag: Arc<dyn RagService> }');
  // ...

  // éªŒè¯ AI èƒ½åˆ†æä¾èµ–å…³ç³»
  expect(aiResponse).toContain('ChatService');
  expect(aiResponse).toContain('QueryCommand');
});

test('RAG-003-Bonus: AI åŒºåˆ†çœŸå®å®ç°å’Œæ³¨é‡Šæ–‡æœ¬', async () => {
  // åŒ…å«è¯¯å¯¼æ€§æ³¨é‡Šçš„æ–‡ä»¶
  mockFS.set('/test_project/src/handlers.rs', `
    // æ³¨æ„ï¼šErrorHandler æœªå®ç° Handler
    // LoggingHandler æœªå®ç° Handler
  `);

  // éªŒè¯ AI ä¸ä¼šè¢«æ³¨é‡Šè¯¯å¯¼
  expect(aiResponse).not.toContain('ErrorHandler');
});
```

---

## ğŸš€ æ€§èƒ½æŒ‡æ ‡

### E2E æµ‹è¯•ç»“æœ

```
âœ“ RAG-003: AI ç†è§£ Trait å®ç°å…³ç³» (18.2s)
âœ“ RAG-004: AI åˆ†æä¾èµ–å…³ç³» (19.4s)
âœ“ RAG-003-Bonus: AI åŒºåˆ†çœŸå®å®ç°å’Œæ³¨é‡Šæ–‡æœ¬ (17.9s)

3 passed (22.3s)
```

### å…³é”®æ”¹è¿›

| é—®é¢˜ | ä¿®å¤ | å½±å“ |
|------|------|------|
| eventId å‚æ•°ä¸åŒ¹é… | `args?.eventId \|\| args?.event_id` | äº‹ä»¶ç›‘å¬å™¨æ­£ç¡®æ¥æ”¶ |
| baseUrl æ ¼å¼é”™è¯¯ | è‡ªåŠ¨è¡¥å…¨ `/chat/completions` | API è°ƒç”¨æˆåŠŸ |
| payload æ ¼å¼ä¸åŒ¹é… | `{ type: 'content', content }` | æ¶ˆæ¯æ­£ç¡®æ˜¾ç¤º |
| invoke å¼‚æ­¥å¤„ç† | è¿”å› Promise ç­‰å¾…å“åº” | æµå¼ä¼ è¾“æ­£å¸¸ |
| æ¶ˆæ¯è·å–æ–¹å¼é”™è¯¯ | ä» chatStore è·å–è€Œé DOM | å¯é è·å–å“åº” |

---

## ğŸ“Š æŠ€æœ¯æ ˆ

### å‰ç«¯
- **Playwright**: E2E æµ‹è¯•æ¡†æ¶
- **Zustand**: çŠ¶æ€ç®¡ç† (chatStore, settingsStore)
- **React**: UI ç»„ä»¶

### Mock ç³»ç»Ÿ
- **tauri-mocks**: Tauri API mock å®ç°
- **çœŸå® AI é›†æˆ**: æ”¯æŒ Kimi (Moonshot AI) API

### åç«¯ (å•†ä¸šç‰ˆ ifainew-core)
- **Rust**: AST åˆ†æå’Œç¬¦å·ç´¢å¼•
- **å‘é‡æ£€ç´¢**: è¯­ä¹‰æœç´¢
- **LLM é›†æˆ**: AI å“åº”ç”Ÿæˆ

---

## ğŸ”œ æœªæ¥è§„åˆ’

### çŸ­æœŸ (v0.2.9)
- [ ] æ”¯æŒæ›´å¤šç¼–ç¨‹è¯­è¨€ (Python, Java, Go)
- [ ] ä¼˜åŒ–æ£€ç´¢å‡†ç¡®ç‡
- [ ] æ·»åŠ ä»£ç å˜æ›´å½±å“åˆ†æ

### ä¸­æœŸ (v0.3.0)
- [ ] å®æ—¶ä»£ç ç´¢å¼•æ›´æ–°
- [ ] è·¨ä»“åº“ä¾èµ–åˆ†æ
- [ ] ä»£ç é‡æ„å»ºè®®

### é•¿æœŸ (v0.4.0)
- [ ] è‡ªé€‚åº”å­¦ä¹ ç”¨æˆ·åå¥½
- [ ] å¤šæ¨¡æ€ä»£ç ç†è§£ (å›¾è¡¨ + ä»£ç )
- [ ] åä½œå¼ä»£ç å®¡æŸ¥

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- **æµ‹è¯•æ–‡ä»¶**: `tests/e2e/rag-symbol-aware.spec.ts`
- **Mock é…ç½®**: `tests/e2e/setup-utils.ts`
- **Tauri Mocks**: `src/tauri-mocks/api/core.ts`

---

## ğŸ‰ æ€»ç»“

RAG ç¬¦å·æ„ŸçŸ¥åŠŸèƒ½çš„å®ç°æ ‡å¿—ç€ ifai ä»"ä»£ç åŠ©æ‰‹"å‘"ä»£ç ç†è§£ä¸“å®¶"çš„è½¬å˜ã€‚é€šè¿‡ç»“åˆï¼š

1. **ç²¾å‡†çš„ç¬¦å·åˆ†æ** - ç†è§£ä»£ç ç»“æ„
2. **è¯­ä¹‰æ£€ç´¢èƒ½åŠ›** - æ‰¾åˆ°ç›¸å…³ä¸Šä¸‹æ–‡
3. **AI å¢å¼ºç”Ÿæˆ** - æä¾›ä¸“ä¸šå»ºè®®

ifai èƒ½å¤Ÿä¸ºå¼€å‘è€…æä¾›æ›´å‡†ç¡®ã€æ›´æœ‰ä»·å€¼çš„ä»£ç åˆ†æå’Œä¿®æ”¹å»ºè®®ï¼ŒçœŸæ­£æˆä¸ºå¼€å‘è€…çš„æ™ºèƒ½ä¼™ä¼´ã€‚

---

*æœ¬æ–‡æ¡£ç”± AI è‡ªåŠ¨ç”Ÿæˆï¼Œè®°å½• RAG ç¬¦å·æ„ŸçŸ¥åŠŸèƒ½çš„å®ç°è¿‡ç¨‹å’ŒæŠ€æœ¯ç»†èŠ‚ã€‚*
