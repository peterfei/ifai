# IfAI Editor v0.2.1 发布说明

发布日期：2025-12-26

## 📋 版本概述

**v0.2.1** 是 IfAI 发展过程中的一个关键里程碑。在这个版本中，我们不仅完成了**社区版与商业版的底层架构分离**，为未来的生态扩展奠定了坚实基础，还集中解决了用户反馈的核心交互问题，特别是在**消息序列化**和**流式渲染**体验上带来了显著提升。

---

## 🚀 核心更新

### 1. 架构重构：社区版与商业版分离
我们通过 Feature Flags 和 Rust 核心 Trait 抽象层，成功实现了社区版（开源）与商业版（私有核心）的完全解耦。
- **动态切换**：支持通过 `APP_EDITION` 环境变量在编译期或运行期切换版本模式。
- **接口标准化**：定义了 `AIService`, `RagService`, `AgentService` 等标准接口，方便未来扩展更多实现。
- **构建优化**：CI/CD 流水线现在可以独立构建不同版本，确保了开源版本的纯净性。

### 2. 交互升级：工具调用自动批准
为了让 Agent 的工作流更加流畅，我们在 AIChat 组件中引入了 `agentAutoApprove` 机制。
- **流畅执行**：在可信环境下，Agent 的连续工具调用（如读取文件 -> 分析 -> 写入文件）不再被频繁打断。
- **体验提升**：配合流式输出的打字机效果，用户可以更直观地看到 Agent "思考-执行" 的完整闭环。

### 3. 模型更新：智谱 AI GLM-4.7
我们将默认模型升级为智谱 AI 最新的 **GLM-4.7**。
- **能力增强**：在代码生成、逻辑推理和长上下文理解方面有显著提升。
- **配置同步**：更新了模型列表配置，确保用户能第一时间体验最新模型能力。

---

## 🛠 问题修复与优化

### 🐛 关键修复
- **消息发送修复**：彻底解决了发送消息时出现的 `missing field 'name'` 错误。我们重构了消息序列化逻辑，确保 `ToolCall` 和 `Message` 结构体在前后端传输中的字段完整性。
- **类型定义对齐**：修复了 Rust 后端与 TypeScript 前端在 `snake_case` 和 `camelCase` 命名风格上的不一致，消除了潜在的反序列化错误。
- **工具参数解析**：修复了工具调用参数在流式传输过程中的解析问题，确保了复杂代码块能被正确提取和显示。

### ✨ 体验优化
- **智能上下文**：引入智能消息筛选机制，在发送请求给 LLM 时，会自动丢弃过期的冗余信息，优先保留系统指令和最近的上下文，既节省 Token 又提高了响应速度。
- **流式高亮**：优化了代码块的流式渲染逻辑，现在即使在生成过程中，代码高亮和格式化也能实时生效，不再有"闪烁"或"样式遮挡"的问题。
- **RAG 自动初始化**：RAG（检索增强生成）索引现在会在项目打开时自动在后台初始化，无需用户手动触发，让代码库问答随时待命。

---

## 📊 变更统计

本次发布包含 **41** 个文件变更，共计 **3437** 行代码增加，**471** 行代码删除。

- `src/stores/useChatStore.ts`: 核心状态管理重构
- `src-tauri/src/lib.rs`: 后端命令处理逻辑优化
- `src-tauri/src/core_traits.rs`: 核心架构抽象接口定义

---

## 🔗 相关链接

- [GitHub 项目主页](https://github.com/peterfei/ifai)
- [完整变更日志](./CHANGELOG.md)
- [问题反馈](https://github.com/peterfei/ifai/issues)

感谢所有参与测试和反馈的开发者，是你们让 IfAI 变得更好！ ❤️